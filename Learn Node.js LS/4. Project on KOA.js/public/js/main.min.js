var loginModule = (function() {
  var t = function() {
      $("#login").on("submit", e);
    },
    e = function(t) {
      console.log("Работаем с формой"), t.preventDefault();
      var e = $(this),
        o = n(e, "/login");
      o &&
        o.done(function(t) {
          var n = t.mes;
          "OK" === t.status
            ? (e.trigger("reset"),
              e
                .find(".success-mes")
                .text(n)
                .show())
            : e
                .find(".error-mes")
                .text(n)
                .show();
          setTimeout(() => location.assign("/work"), 2000);
        });
    },
    n = function(t, e) {
      if (!validation.validateForm(t)) return !1;
      var n = t.serialize();
      return $.ajax({ type: "POST", url: e, dataType: "JSON", data: n }).fail(
        function(e) {
          console.log("Проблемы в PHP"),
            t
              .find(".error-mes")
              .text("На сервере произошла ошибка")
              .show();
        }
      );
    };
  return {
    init: function() {
      console.log("Инициализация модуля loginModule"), t();
    }
  };
})();
$("#login").length && loginModule.init();
var addProject = (function() {
  var t = function() {
      console.log("Инициализация модуля addProject"), e();
    },
    e = function() {
      $("#add-new-item").on("click", n),
        $("#add-new-project").on("submit", _addProject);
    },
    n = function() {
      console.log("Вызов модального окна"),
        $("#new-progect-popup").bPopup({
          speed: 650,
          transition: "slideDown",
          onClose: function() {
            this.find(".form").trigger("reset");
          }
        });
    };
  return (
    (_addProject = function(t) {
      console.log("Работаем с формой добавления проекта"), t.preventDefault();
      var e = $(this),
        n = _ajaxForm(this, "/work");
      n &&
        n.done(function(t) {
          var n = t.mes;
          "OK" === t.status
            ? (e.trigger("reset"),
              e
                .find(".success-mes")
                .text(n)
                .show(),
              location.reload())
            : e
                .find(".error-mes")
                .text(n)
                .show();
        });
    }),
    (_ajaxForm = function(t, e) {
      if (!validation.validateForm($(t))) return !1;
      var n = new FormData(t);
      return $.ajax({
        type: "POST",
        url: e,
        data: n,
        contentType: !1,
        cache: !1,
        processData: !1
      }).fail(function(e) {
        console.log("Проблемы в PHP"),
          t
            .find(".error-mes")
            .text("На сервере произошла ошибка")
            .show();
      });
    }),
    { init: t }
  );
})();
$("#add-new-project").length && addProject.init();
var validation = (function() {
  var t = function() {
      console.log("Инициализация модуля validation"), n();
    },
    e = function(t) {
      console.log("Проверяем форму");
      var e = t
          .find("input, textarea")
          .not('input[type="hidden"], input[disabled]'),
        n = !0;
      return (
        $.each(e, function(t, e) {
          var o = $(e),
            e = o.val(),
            i = o.attr("qtip-position");
          0 === e.length && (o.addClass("has-error"), r(o, i), (n = !1));
        }),
        n
      );
    },
    n = function() {
      $("form").on("input", ".has-error", o),
        $("form").on("keydown", ".has-error", o),
        $("form").on("reset", i);
    },
    o = function() {
      console.log("Красная обводка у элементов форм удалена"),
        $(this).removeClass("has-error");
    },
    i = function(t) {
      console.log("Очищаем форму");
      var t = $(this);
      t.find(".input, .textarea, .fileupload").trigger("hideTooltip"),
        t.find(".has-error").removeClass("has-error"),
        t
          .find(".error-mes, .success-mes")
          .text("")
          .hide();
    },
    r = function(t, e) {
      console.log("Создаем тултип"),
        (e =
          "right" === e
            ? { my: "left center", at: "right center" }
            : {
                my: "right center",
                at: "left center",
                adjust: { method: "shift none" }
              }),
        t
          .qtip({
            content: {
              text: function() {
                return $(this).attr("qtip-content");
              }
            },
            show: { event: "show" },
            hide: { event: "keydown hideTooltip" },
            position: e,
            style: {
              classes: "qtip-mystyle qtip-rounded",
              tip: { height: 10, width: 16 }
            }
          })
          .trigger("show");
    };
  return { init: t, validateForm: e };
})();
$("form").length && validation.init();
var contactMe = (function() {
  var t = function() {
      $("#contact-me").on("submit", e);
    },
    e = function(t) {
      console.log("Работаем с формой связи"), t.preventDefault();
      var e = $(this),
        o = n(e, "/contact");
      o &&
        o.done(function(t) {
          var n = t.mes;
          "OK" === t.status
            ? (e.trigger("reset"),
              e
                .find(".success-mes")
                .text(n)
                .show())
            : e
                .find(".error-mes")
                .text(n)
                .show();
        });
    },
    n = function(t, e) {
      if (!validation.validateForm(t)) return !1;
      var n = t.serialize();
      return $.ajax({ type: "POST", url: e, dataType: "JSON", data: n }).fail(
        function(e) {
          console.log("Проблемы в PHP"),
            t
              .find(".error-mes")
              .text("На сервере произошла ошибка")
              .show();
        }
      );
    };
  return {
    init: function() {
      console.log("Инициализация модуля contactMe"), t();
    }
  };
})();
$("#contact-me").length && contactMe.init();
